<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Threadboard Markdown Ultra-Lite</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <header class="top-bar">
        <div class="controls-wrapper">
          <div class="file-controls">
            <button id="open-file">Open Markdown…</button>
            <button id="create-file">Create Markdown…</button>
            <button id="export-html" disabled>Export View to HTML…</button>
          </div>
          <div class="utility-controls">
            <button id="view-raw" disabled>View Raw Markdown</button>
            <button id="reveal-file" disabled>Reveal in Finder</button>
            <button id="copy-path" disabled>Copy Path</button>
            <button id="open-guide" type="button">Guide</button>
          </div>
        </div>
        <div class="file-status">
          <span id="current-file">No file selected</span>
          <span id="watch-status"></span>
        </div>
      </header>
      <div id="search-panel" class="search-panel" aria-hidden="true">
        <input id="search-input" type="text" placeholder="Search threads…" autocomplete="off" />
        <span id="search-count" class="search-count"></span>
        <div class="search-buttons">
          <button id="search-prev" type="button" aria-label="Previous match">&#x2039;</button>
          <button id="search-next" type="button" aria-label="Next match">&#x203a;</button>
          <button id="search-close" type="button" aria-label="Close search">&#x00d7;</button>
        </div>
      </div>
      <section class="thread-actions">
        <form id="new-thread-form">
          <label for="new-thread-name">New thread name</label>
          <input id="new-thread-name" type="text" placeholder="Leave blank for untitled" />
          <button type="submit">Add Thread</button>
        </form>
        <div class="settings-row">
          <label for="delimiter-input">Delimiter</label>
          <input id="delimiter-input" type="text" placeholder="---" />
          <label for="thread-format">Thread format</label>
          <select id="thread-format">
            <option value="auto">Auto</option>
            <option value="heading">Headings</option>
            <option value="delimiter">Delimiter only</option>
          </select>
          <label for="column-width" class="column-width-label">Column width</label>
          <input id="column-width" type="range" min="240" max="600" step="20" value="320" />
          <span id="column-width-value" class="column-width-value">320 px</span>
        </div>
      </section>
      <div id="alerts"></div>
      <main id="thread-columns" class="thread-columns empty" tabindex="0">
        <div class="placeholder">Select or create a Markdown file to begin.</div>
      </main>
      <div id="raw-modal" class="modal">
        <div class="modal-inner">
          <div class="modal-header">
            <h3>Raw Markdown</h3>
            <button id="raw-close" type="button">Close</button>
          </div>
          <textarea id="raw-text" readonly></textarea>
        </div>
      </div>
      <div id="guide-modal" class="modal">
        <div class="modal-inner guide-modal-inner">
          <div class="modal-header">
            <h3>Threadboard Markdown Guide</h3>
            <button id="guide-close" type="button">Close</button>
          </div>
          <div id="guide-body">
            <section>
              <h4>Conversation Basics</h4>
              <ul>
                <li>Plain lines are human messages. Prefix AI replies with <code>&gt; </code>.</li>
                <li>You can begin with a simple single-column chat log; threads are optional.</li>
                <li>Leave blank lines between thoughts when it improves readability.</li>
              </ul>
            </section>
            <section>
              <h4>Creating Threads</h4>
              <ul>
                <li>Start a column with a heading: <code>## [thread-name]</code>.</li>
                <li>Alternatively use a delimiter line (default <code>---</code>) to split conversations.</li>
                <li>Thread names may be left blank; the first message becomes the display title.</li>
              </ul>
            </section>
            <section>
              <h4>Adding Messages</h4>
              <ul>
                <li>Human entries append exactly as typed.</li>
                <li>AI entries add the <code>&gt;</code> prefix automatically.</li>
                <li>Use the per-column input area or edit the Markdown directly.</li>
                <li>Paste Codex CLI transcripts (lines beginning with <code>▌</code> or <code>&gt;</code>) and Threadboard will offer to split them into human and AI messages.</li>
                <li>Ignore lines that are pure code/diffs unless the discussion refers to them; summarize large code blocks rather than pasting them verbatim.</li>
              </ul>
            </section>
            <section>
              <h4>Managing Threads</h4>
              <ul>
                <li>Click a title to rename; delimiter threads get promoted to headings when renamed.</li>
                <li>Delete removes the heading and all messages in that section.</li>
                <li>Adjust delimiter and format preferences in the settings row above the board.</li>
              </ul>
            </section>
            <section>
              <h4>File Watching &amp; Collaboration</h4>
              <ul>
                <li>The app reloads when the Markdown file changes on disk.</li>
                <li>Use <em>View Raw Markdown</em> to inspect the exact content.</li>
                <li>Reveal or copy the current file path via the utility buttons.</li>
              </ul>
            </section>
            <section>
              <h4>Advanced Tips</h4>
              <ul>
                <li>Plain-chat sections before the first thread act as the main timeline.</li>
                <li>Mix headings and delimiters to branch conversations without losing context.</li>
                <li>Export to HTML for quick sharing or archiving.</li>
              </ul>
            </section>
            <section>
              <h4>Codex Prompt Template</h4>
              <p>Share this with another Codex session to keep the log consistent:</p>
              <button id="copy-codex-prompt" type="button" class="copy-button">Copy</button>
              <pre><code id="codex-prompt-text">Please maintain the running thread log in threadboard.md throughout our conversation.

Guidelines:
1. The file is partitioned with `---` delimiters. Each section heading must be formatted `## [Thread Title]`.
2. Group messages into a small number of active threads (reuse existing sections when possible; add new ones only when a truly distinct topic emerges).
3. Under each heading, record both participants’ raw text in chronological order:
   • User lines are copied verbatim (no prefix).
   • Assistant lines are the same text but prefixed with `> `.
4. After every exchange, append the new messages to the appropriate section(s). If a message spans multiple topics, duplicate it under each relevant thread.
5. Never remove existing content; only append.
6. Keep the file well-formed Markdown: delimiter line, heading, alternating user/assistant entries, delimiter line, etc.

At the end of the session, the file should reflect the full conversation history, organized by thread with matching format.
</code></pre>
            </section>
            <section>
              <h4>Thread Parsing Prompt</h4>
              <p>Use this when you want Codex/GPT to split a raw transcript into threadboard format:</p>
              <button id="copy-parse-prompt" type="button" class="copy-button">Copy</button>
              <pre><code id="parse-prompt-text">You are ThreadBoard, responsible for organizing chat transcripts into thematic threads.

Input: I will paste raw conversation lines (chronological). Each line begins with either "User:" or "Assistant:".

Task:
1. Analyze the conversation and identify the minimal set of coherent threads (aim for ~3 unless the content clearly demands more).
2. Create `threadboard.md` with the following structure:
   ---
   ## [Thread Title]
   User: ...
   > Assistant: ...
   ---
   (repeat sections for each thread)
3. Place each message in every thread it belongs to (duplicate entries if a message spans topics). Preserve the original text.
4. Only add `> ` in front of assistant lines.
5. When unsure which thread to use, prefer the closest thematic match rather than creating new ones.

Output: the complete markdown file contents.

Now, please wait for the transcript.
</code></pre>
            </section>
            <section>
              <h4>Apple Notes Parsing Prompt</h4>
              <p>Use this when parsing chronological notes (e.g., from Apple Notes or voice dictation) into thematic threads:</p>
              <button id="copy-notes-prompt" type="button" class="copy-button">Copy</button>
              <pre><code id="notes-prompt-text">You are ThreadBoard, responsible for organizing chronological notes into thematic threads.

Context: These are stream-of-consciousness notes taken chronologically (often via voice dictation), switching between different topics throughout. Some notes may be incomplete due to dictation cutoffs, with the next note being a continuation or correction.

Task:
1. Analyze the notes and identify the minimal set of coherent threads.
2. Create `threadboard.md` with the following structure:
   ---
   ## [Thread Title]
   note 1
   note 2
   ...
   ---
   (repeat sections for each thread)
3. Place each note in every thread it belongs to (duplicate if a note spans multiple topics). Preserve the original text 99% of the time.
4. If consecutive notes appear to be a continuation or correction due to dictation issues, you may merge or lightly correct them where obviously intended.
5. When unsure which thread to use, prefer the closest thematic match rather than creating new ones.

Output: the complete markdown file contents, maintaining the original language and voice.

Now, please paste the notes to organize.
</code></pre>
            </section>
          </div>
        </div>
      </div>
    </div>
    <script src="renderer.js"></script>
  </body>
</html>
